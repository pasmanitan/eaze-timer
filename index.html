<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="the greatest timer on the planet" />
    <title>eaze</title>
    <script>
      // SERVICE WORKER REGISTRATION
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", async () => {
          try {
            let reg = await navigator.serviceWorker.register(
              "https://eaze-timer.vercel.app/assets/sw.js",
            );
            console.log("Service worker registered! ðŸ˜Ž", reg);
          } catch (err) {
            console.log("ðŸ˜¥ Service worker registration failed: ", err);
          }
        });
      }
    </script>
    <script src="./assets/sw.js"></script>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./assets/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./assets/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="./assets/favicon/site.webmanifest" />
    <audio id="jingle" src="./assets/audio/jingle.wav"></audio>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html {
        color: #fff;
        background: #000;
        margin: 0;
        font-size: clamp(1.5rem, -1rem + 6.4vw, 2.5rem);
        scrollbar-width: none;
        -ms-overflow-style: none;

        -webkit-text-size-adjust: 100%;
        text-rendering: optimizeLegibility;
        margin: 0;
        padding: 0;
        border: 0;
      }

      html::-webkit-scrollbar {
        display: none;
      }
      .container {
        display: flex;
        min-height: 100dvh;
        align-items: center;
        align-content: center;
        justify-content: center;
      }
      #timer {
        margin: 0 auto;
        font-size: 3em;
        width: 4em;
        background-color: transparent;
        color: white;
        border: 0;
        outline: none;
      }
      #timer_label {
        cursor: pointer;
      }
      #jingle {
        display: none;
      }
    </style>
  </head>
  <body>
    <main>
      <div class="container">
        <form id="form" style="display: flex; flex-flow: column wrap">
          <label
            name="timer"
            for="timer"
            id="timer_label"
            style="text-align: center; color: #8a8a8a; font-family: monospace"
            onclick="window.open('https://pasmanitan.vercel.app', '_blank')"
            onmouseover="this.textContent = 'made by paz'"
            onmouseout="this.textContent = 'eaze timer'"
            >eaze timer</label
          >
          <input
            name="timer"
            id="timer"
            pattern="[0-9:]*"
            placeholder="00:00:00"
            maxlength="8"
            autocomplete="off"
            dir="rtl"
          />
        </form>
      </div>
    </main>
    <script>
      // ELEMENTS

      const form = document.getElementById("form");
      const timer = document.querySelector("#timer");
      const tlab = document.querySelector("#timer_label");
      const jingle = document.querySelector("#jingle");

      // STATE HANDLERS

      let si = null;
      let ton = false;

      // FUNCTIONS

      function updateDisplay(h, m, s) {
        timer.value =
          `${h < 10 ? "0" + h : h}:` +
          `${m < 10 ? "0" + m : m}:` +
          `${s < 10 ? "0" + s : s}`;
        document.title = timer.value;
      }

      function startTimer() {
        let vals = form.elements["timer"].value.trim().split(":");
        let hrs = 0;
        let mins = 0;
        let secs = 0;

        if (vals.length === 3) {
          [hrs, mins, secs] = vals.map((n) => Number(n) || 0);
        } else if (vals.length === 2) {
          [mins, secs] = vals.map((n) => Number(n) || 0);
        } else if (vals.length === 1) {
          secs = Number(vals[0]) || 0;
        }

        if (si === null && (hrs > 0 || mins > 0 || secs > 0)) {
          ton = true;
          tlab.textContent = "[t]oggle [r]eset";
          timer.blur();
          si = setInterval(() => {
            if (hrs === 0 && mins === 0 && secs === 0) {
              resetTimer();
              jingle.play();
              return;
            }
            if (secs === 0) {
              if (mins > 0) {
                mins--;
                secs = 59;
              } else if (hrs > 0) {
                hrs--;
                mins = 59;
                secs = 59;
              }
            } else {
              secs--;
            }
            updateDisplay(hrs, mins, secs);
          }, 1000);
        }
      }

      function stopTimer() {
        clearInterval(si);
        ton = false;
        si = null;
      }

      function resetTimer() {
        stopTimer();
        timer.value = "";
        tlab.textContent = "eaze timer";
        document.title = "eaze";
      }

      // EVENT LISTENERS

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        startTimer();
      });

      timer.addEventListener("input", function () {
        this.value = this.value.replace(/[^0-9:]/g, "");
      });

      timer.addEventListener("focus", (e) => {
        tlab.textContent = "[f]ocus";
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === " " || e.key === "t") {
          e.preventDefault();
          if (ton) {
            stopTimer();
          } else {
            startTimer();
          }
        }
        if (e.key === "r") {
          resetTimer();
        }

        if (e.key === "f") {
          e.preventDefault();
          if (timer.matches(":focus") === true) {
            timer.blur();
          } else {
            timer.focus();
          }
        }
      });
    </script>
    <script>
      window.va =
        window.va ||
        function () {
          (window.vaq = window.vaq || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
  </body>
</html>
